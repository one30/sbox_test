/*
 * @Descripttion : 
 * @Version      : 
 * @Autor        : one30: one30@m.scnu.edu.cn(email)
 * @Date         : 2021-06-11 17:04:10
 * @LastEditTime : 2021-07-17 15:42:57
 * @FilePath     : /sbox_test/src/sbox_x86.c
 */
#include "sbox_x86.h"

void Sm4_BoolFun(bits in, bit_t *out0, bit_t *out1, bit_t *out2, bit_t *out3, bit_t *out4, bit_t *out5, bit_t *out6, bit_t *out7){
        bit_t y_t[21], t_t[8], t_m[46], y_m[18], t_b[30];
  	    y_t[18] = in.b2 ^in.b6;
		t_t[ 0] = in.b3 ^in.b4;
		t_t[ 1] = in.b2 ^in.b7;
		t_t[ 2] = in.b7 ^y_t[18];
		t_t[ 3] = in.b1 ^t_t[ 1];
		t_t[ 4] = in.b6 ^in.b7;
		t_t[ 5] = in.b0 ^y_t[18];
		t_t[ 6] = in.b3 ^in.b6;
		y_t[10] = in.b1 ^y_t[18];
		y_t[ 0] = in.b5 ^~ y_t[10];
		y_t[ 1] = t_t[ 0] ^t_t[ 3];
		y_t[ 2] = in.b0 ^t_t[ 0];
		y_t[ 4] = in.b0 ^t_t[ 3];
		y_t[ 3] = in.b3 ^y_t[ 4];
		y_t[ 5] = in.b5 ^t_t[ 5];
		y_t[ 6] = in.b0 ^~ in.b1;
		y_t[ 7] = t_t[ 0] ^~ y_t[10];
		y_t[ 8] = t_t[ 0] ^t_t[ 5];
		y_t[ 9] = in.b3;
		y_t[11] = t_t[ 0] ^t_t[ 4];
		y_t[12] = in.b5 ^t_t[ 4];
		y_t[13] = in.b5 ^~ y_t[ 1];
		y_t[14] = in.b4 ^~ t_t[ 2];
		y_t[15] = in.b1 ^~ t_t[ 6];
		y_t[16] = in.b0 ^~ t_t[ 2];
		y_t[17] = t_t[ 0] ^~ t_t[ 2];
		y_t[19] = in.b5 ^~ y_t[14];
		y_t[20] = in.b0 ^t_t[ 1];

    //The shared non-linear middle part for AES, AES^-1, and SM4
  	t_m[ 0] = y_t[ 3] ^	 y_t[12];
		t_m[ 1] = y_t[ 9] &	 y_t[ 5];
		t_m[ 2] = y_t[17] &	 y_t[ 6];
		t_m[ 3] = y_t[10] ^	 t_m[ 1];
		t_m[ 4] = y_t[14] &	 y_t[ 0];
		t_m[ 5] = t_m[ 4] ^	 t_m[ 1];
		t_m[ 6] = y_t[ 3] &	 y_t[12];
		t_m[ 7] = y_t[16] &	 y_t[ 7];
		t_m[ 8] = t_m[ 0] ^	 t_m[ 6];
		t_m[ 9] = y_t[15] &	 y_t[13];
		t_m[10] = t_m[ 9] ^	 t_m[ 6];
		t_m[11] = y_t[ 1] &	 y_t[11];
		t_m[12] = y_t[ 4] &	 y_t[20];
		t_m[13] = t_m[12] ^	 t_m[11];
		t_m[14] = y_t[ 2] &	 y_t[ 8];
		t_m[15] = t_m[14] ^	 t_m[11];
		t_m[16] = t_m[ 3] ^	 t_m[ 2];
		t_m[17] = t_m[ 5] ^	 y_t[18];
		t_m[18] = t_m[ 8] ^	 t_m[ 7];
		t_m[19] = t_m[10] ^	 t_m[15];
		t_m[20] = t_m[16] ^	 t_m[13];
		t_m[21] = t_m[17] ^	 t_m[15];
		t_m[22] = t_m[18] ^	 t_m[13];
		t_m[23] = t_m[19] ^	 y_t[19];
		t_m[24] = t_m[22] ^	 t_m[23];
		t_m[25] = t_m[22] &	 t_m[20];
		t_m[26] = t_m[21] ^	 t_m[25];
		t_m[27] = t_m[20] ^	 t_m[21];
		t_m[28] = t_m[23] ^	 t_m[25];
		t_m[29] = t_m[28] &	 t_m[27];
		t_m[30] = t_m[26] &	 t_m[24];
		t_m[31] = t_m[20] &	 t_m[23];
		t_m[32] = t_m[27] &	 t_m[31];
		t_m[33] = t_m[27] ^	 t_m[25];
		t_m[34] = t_m[21] &	 t_m[22];
		t_m[35] = t_m[24] &	 t_m[34];
		t_m[36] = t_m[24] ^	 t_m[25];
		t_m[37] = t_m[21] ^	 t_m[29];
		t_m[38] = t_m[32] ^	 t_m[33];
		t_m[39] = t_m[23] ^	 t_m[30];
		t_m[40] = t_m[35] ^	 t_m[36];
		t_m[41] = t_m[38] ^	 t_m[40];
		t_m[42] = t_m[37] ^	 t_m[39];
		t_m[43] = t_m[37] ^	 t_m[38];
		t_m[44] = t_m[39] ^	 t_m[40];
		t_m[45] = t_m[42] ^	 t_m[41];
		y_m[ 0] = t_m[38] &	 y_t[ 7];
		y_m[ 1] = t_m[37] &	 y_t[13];
		y_m[ 2] = t_m[42] &	 y_t[11];
		y_m[ 3] = t_m[45] &	 y_t[20];
		y_m[ 4] = t_m[41] &	 y_t[ 8];
		y_m[ 5] = t_m[44] &	 y_t[ 9];
		y_m[ 6] = t_m[40] &	 y_t[17];
		y_m[ 7] = t_m[39] &	 y_t[14];
		y_m[ 8] = t_m[43] &	 y_t[ 3];
		y_m[ 9] = t_m[38] &	 y_t[16];
		y_m[10] = t_m[37] &	 y_t[15];
		y_m[11] = t_m[42] &	 y_t[ 1];
		y_m[12] = t_m[45] &	 y_t[ 4];
		y_m[13] = t_m[41] &	 y_t[ 2];
		y_m[14] = t_m[44] &	 y_t[ 5];
		y_m[15] = t_m[40] &	 y_t[ 6];
		y_m[16] = t_m[39] &	 y_t[ 0];
		y_m[17] = t_m[43] &	 y_t[12];

  //bottom(outer) linear layer for sm4
  	t_b[ 0] = y_m[ 4] ^	 y_m[ 7];
		t_b[ 1] = y_m[13] ^	 y_m[15];
		t_b[ 2] = y_m[ 2] ^	 y_m[16];
		t_b[ 3] = y_m[ 6] ^	 t_b[ 0];
		t_b[ 4] = y_m[12] ^	 t_b[ 1];
		t_b[ 5] = y_m[ 9] ^	 y_m[10];
		t_b[ 6] = y_m[11] ^	 t_b[ 2];
		t_b[ 7] = y_m[ 1] ^	 t_b[ 4];
		t_b[ 8] = y_m[ 0] ^	 y_m[17];
		t_b[ 9] = y_m[ 3] ^	 y_m[17];
		t_b[10] = y_m[ 8] ^	 t_b[ 3];
		t_b[11] = t_b[ 2] ^	 t_b[ 5];
		t_b[12] = y_m[14] ^	 t_b[ 6];
		t_b[13] = t_b[ 7] ^	 t_b[ 9];
		t_b[14] = y_m[ 0] ^	 y_m[ 6];
		t_b[15] = y_m[ 7] ^	 y_m[16];
		t_b[16] = y_m[ 5] ^	 y_m[13];
		t_b[17] = y_m[ 3] ^	 y_m[15];
		t_b[18] = y_m[10] ^	 y_m[12];
		t_b[19] = y_m[ 9] ^	 t_b[ 1];
		t_b[20] = y_m[ 4] ^	 t_b[ 4];
		t_b[21] = y_m[14] ^	 t_b[ 3];
		t_b[22] = y_m[16] ^	 t_b[ 5];
		t_b[23] = t_b[ 7] ^	 t_b[14];
		t_b[24] = t_b[ 8] ^	 t_b[11];
		t_b[25] = t_b[ 0] ^	 t_b[12];
		t_b[26] = t_b[17] ^	 t_b[ 3];
		t_b[27] = t_b[18] ^	 t_b[10];
		t_b[28] = t_b[19] ^	 t_b[ 6];
		t_b[29] = t_b[ 8] ^	 t_b[10];
		*out0 = t_b[11] ^~ t_b[13];
		*out1 = t_b[15] ^~ t_b[23];
		*out2 = t_b[20] ^	 t_b[24];
		*out3 = t_b[16] ^	 t_b[25];
		*out4 = t_b[26] ^~ t_b[22];
		*out5 = t_b[21] ^	 t_b[13];
		*out6 = t_b[27] ^~ t_b[12];
		*out7 = t_b[28] ^~ t_b[29];
}

// void Sm4_Scrutinizing_154gates(bits in, bit_t *out0, bit_t *out1, bit_t *out2, bit_t *out3, bit_t *out4, bit_t *out5, bit_t *out6, bit_t *out7){
//         bit_t y_t[21], t_t[8], t_m[46], y_m[18], t_b[30];
// /*      input:
//         t1 = (in.b7 ^ in.b5);
//         t2 = ~(in.b5 ^ in.b1);
//         t3 = ~(in.b0 ^ t2 );
//         t4 = (in.b6 ^ in.b2);
//         t5 = (in.b3 ^ t3 );
//         t6 = (in.b4 ^ t1 );
//         t7 = (in.b1 ^ t5 );
//         t8 = (in.b1 ^ t4 );
//         t9 = (t6 ^ t8 );
//         t10 = (t6 ^ t7 );
//         t11 = ~(in.b3 ^ t1 );
//         t12 = ~(in.b6 ^ t9 );
//         t13 = (t4 ^ t10 );
//         t14 = (t2 ^ t11 );
//         t15 = (t12 ^ t14 );
//         t16 = (t3 ^ t12 );
//         t17 = (t11 ^ t16 ); 
//         assign g = {t15 , t14 , ~b[0], t2 , t5 , t13 , t7 , t10 };
//         assign m = {t12 , t9 , t17 , b[1], t11 , t4 , t16 , t8 , t3 , t6 };*/
        
//         bit_t t, g[8], m[10];
//         t = (in.b7 ^ in.b5);
//         g[4] = ~(in.b5 ^ in.b1);
//         m[1] = ~(in.b0 ^ g[4] );
//         m[4] = (in.b6 ^ in.b2);
//         g[3] = (in.b3 ^ m[1] );
//         m[0] = (in.b4 ^ t );
//         g[1] = (in.b1 ^ g[3] );
//         m[2] = (in.b1 ^ m[4] );
//         m[8] = (m[0] ^ m[2] );
//         g[0] = (m[0] ^ g[1] );
//         m[5] = ~(in.b3 ^ t );
//         m[9] = ~(in.b6 ^ m[8] );
//         g[2] = (m[4] ^ g[0] );
//         g[6] = (g[4] ^ m[5] );
//         g[7] = (m[9] ^ g[6] );
//         m[3] = (m[1] ^ m[9] );
//         m[7] = (m[5] ^ m[3] ); 

//         g[5] = ~in.b0;
//         m[6] = in.b1;

//         // top:
//         bit_t p[4],t1,t2,t3,t4,t5,t6,t7,t8,t9,t10,t11,t12,t13,t14,t15,t16,t17,t18,t19,t20;
//         t1 = ( g[5] & g[1]);
//         t2 = ( m[1] & m[0]);
//         t3 = ( g[4] & g[0]);
//         t4 = ( g[7] & g[3]);
//         t5 = ( m[9] & m[8]);
//         t6 = ( g[6] | g[2]);
//         t7 = ( g[7] | g[3]);
//         t8 = ( m[9] | m[8]);
//         t9 = ( m[7] | m[6]);
//         t10 = ( m[3] & m[2]);
//         t11 = ( m[5] & m[4]);
//         t12 = ( m[3] | m[2]);

//         t13 = (t1 ^ t2 );
//         t14 = (t3 ^ t2 );
//         t15 = (t4 ^ t13 );
//         t16 = (t5 ^ t14 );
//         t17 = (t9 ^ t10 );
//         t18 = (t11 ^ t12 );
//         t19 = (t6 ^ t15 );
//         t20 = (t7 ^ t16 );
//         p[3] = (t19 ^ t17 );
//         p[2] = (t20 ^ t18 );
//         p[1] = (t8 ^ t15 );
//         p[0] = (t6 ^ t16 );
//         // t21 = (t19 ^ t17 );
//         // t22 = (t20 ^ t18 );
//         // t23 = (t8 ^ t15 );
//         // t24 = (t6 ^ t16 );
// /*         bit_t m0,m1,m2,m3,m4,m5,m6,m7,m8;
//         m0 = g[7] ^ g[3];
//         m1 = g[6] ^ g[2];
//         m2 = g[5] ^ g[1];
//         m3 = g[4] ^ g[0];
//         m4 = g[7] ^ g[5];
//         m5 = g[6] ^ g[1];
//         m6 = g[6] ^ g[4];
//         m7 = g[2] ^ g[0];
//         m8 = m4 ^ m7;

//         p[3] = (g[7]&g[3]) ^ (g[6]&g[2]) ^ (g[5]&g[1]) ^ (m4&m5) ^ m8;
//         p[2] = (g[7]|g[3]) ^ (g[4]|g[0]) ^ (m6&m7) ^ m2;
//         p[1] = (g[7]&g[3]) ^ (g[5]|g[1]);
//         p[0] = (g[6]^g[2]) ^ (g[4]|g[0]) ^ m0; */



//         // mid
//         bit_t l[4];
//         t1 = ~(p[3] & p[0]);
//         t2 = ~(t1 | p[2]);
//         t3 = ~(p[2] & p[0]);
//         t4 = (p[1] ^ t3 );
//         t5 = ~(p[2] | t4 );
//         t6 = ~(p[1] & t4 );
//         t7 = ~(p[3] | t4 );
//         t8 = ~(t7 | t2 );
//         t9 = ~(t5 ^ t7 );
//         l[0] = ~(t9 ^ p[3]);
//         l[2] = ~(t6 & t8 );
//         t12 = ~(t8 & p[1]);
//         l[3] = ~(p[0] ^ t12 );
//         t14 = ~(t1 & p[2]);
//         l[1] = ~(t9 & t14 );
        

//         // bottom
//         bit_t e[18], k0, k1, k2, k3, k4;
//         k4 = (l[3] ^ l[2]);
//         k3 = (l[3] ^ l[1]);
//         k2 = (l[2] ^ l[0]);
//         k1 = (k3 ^ k2 );
//         k0 = (l[1] ^ l[0]);
//         // e[17]= ~(g[2] & l[2]);
//         // e[16]= ~(g[3] & l[3]);
//         // e[15]= ~(m[8] & k4 );
//         // e[14]= ~(m[2] & k1 );
//         // e[13]= ~(m[4] & k2 );
//         // e[12]= ~(m[6] & k3 );
//         // e[11]= ~(g[0] & l[0]);
//         // e[10]= ~(g[1] & l[1]);
//         // e[9]= ~(m[0] & k0 );
//         // e[8]= ~(g[6] & l[2]);
//         // e[7]= ~(g[7] & l[3]);
//         // e[6]= ~(m[9] & k4 );
//         // e[5]= ~(m[3] & k1 );
//         // e[4]= ~(m[5] & k2 );
//         // e[3]= ~(m[7] & k3 );
//         // e[2]= ~(g[4] & l[0]);
//         // e[1]= ~(g[5] & l[1]);
//         // e[0]= ~(m[1] & k0 );
//         e[17]= (g[2] & l[2]);
//         e[16]= (g[3] & l[3]);
//         e[15]= (m[8] & k4 );
//         e[14]= (m[2] & k1 );
//         e[13]= (m[4] & k2 );
//         e[12]= (m[6] & k3 );
//         e[11]= (g[0] & l[0]);
//         e[10]= (g[1] & l[1]);
//         e[9]= (m[0] & k0 );
//         e[8]= (g[6] & l[2]);
//         e[7]= (g[7] & l[3]);
//         e[6]= (m[9] & k4 );
//         e[5]= (m[3] & k1 );
//         e[4]= (m[5] & k2 );
//         e[3]= (m[7] & k3 );
//         e[2]= (g[4] & l[0]);
//         e[1]= (g[5] & l[1]);
//         e[0]= (m[1] & k0 );

//         // output
//         bit_t E0, E1, E2, E3, E4, E5, E6, E7, E8, E9, E10, E11;
//         E11 =(e[17] ^ e[16]);
//         E10 =(e[15] ^ e[16]);
//         E9 =(e[14] ^ e[13]);
//         E8 =(e[12] ^ e[13]);
//         E7 =(e[11] ^ e[10]);
//         E6 =(e[9] ^ e[10]);
//         E5 =(e[8] ^ e[7]);
//         E4 =(e[6] ^ e[7]);
//         E3 =(e[5] ^ e[4]);
//         E2 =(e[3] ^ e[4]);
//         E1 =(e[2] ^ e[1]);
//         E0 =(e[0] ^ e[1]);
//         t1 =(E9 ^ E7 );
//         t2 =(E1 ^ t1 );
//         t3 =(E3 ^ t2 );
//         t4 =(E5 ^ E3 );
//         t5 =(E4 ^ t4 );
//         t6 =(E4 ^ E0 );
//         t7 =(E11 ^ E7 );
//         t8 =(t1 ^ t4 );
//         t9 =(t1 ^ t6 );
//         t10 =(E2 ^ t5 );
//         t11 =(E10 ^ E8 );
//         t12 =~(t3 ^ t11 );
//         t13 =(t10 ^ t12 );
//         t14 =~(t3 ^ t7 );
//         t15 =~(E10 ^ E6 );
//         t16 =(t6 ^ t14 );
//         // *out0 = t15;
//         // *out1 = t13;
//         // *out2 = t8;
//         // *out3 = t14;
//         // *out4 = t11;
//         // *out5 = t9;
//         // *out6 = t12;
//         // *out7 = t16;
//         *out7 = t15;
//         *out6 = t13;
//         *out5 = t8;
//         *out4 = t14;
//         *out3 = t11;
//         *out2 = t9;
//         *out1 = t12;
//         *out0 = t16;
// }

void Sm4_Scrutinizing_154gates(bits in, bit_t *out0, bit_t *out1, bit_t *out2, bit_t *out3, bit_t *out4, bit_t *out5, bit_t *out6, bit_t *out7){
        bit_t ti, g[8], m[10];

        // input 
        ti = (in.b7 ^ in.b5);
        g[4] = ~(in.b5 ^ in.b1);
        m[1] = ~(in.b0 ^ g[4] );
        m[4] = (in.b6 ^ in.b2);
        g[3] = (in.b3 ^ m[1] );
        m[0] = (in.b4 ^ ti );
        g[1] = (in.b1 ^ g[3] );
        m[2] = (in.b1 ^ m[4] );
        m[8] = (m[0] ^ m[2] );
        g[0] = (m[0] ^ g[1] );
        m[5] = ~(in.b3 ^ ti );
        m[9] = ~(in.b6 ^ m[8] );
        g[2] = (m[4] ^ g[0] );
        g[6] = (g[4] ^ m[5] );
        g[7] = (m[9] ^ g[6] );
        m[3] = (m[1] ^ m[9] );
        m[7] = (m[5] ^ m[3] ); 

        g[5] = ~in.b0;
        m[6] = in.b1;

        // top:
        bit_t p[4],t[21];
        t[1] = ( g[5] & g[1]);
        t[1] = ~t[1];
        t[2] = ( m[1] & m[0]);
        t[2] = ~t[2];
        t[3] = ( g[4] & g[0]);
        t[3] = ~t[3];
        t[4] = ( g[7] & g[3]);
        t[4] = ~t[4];
        t[5] = ( m[9] & m[8]);
        t[5] = ~t[5];
        t[6] = ( g[6] | g[2]);
        t[6] = ~t[6];
        t[7] = ( g[7] | g[3]);
        t[7] = ~t[7];
        t[8] = ( m[9] | m[8]);
        t[8] = ~t[8];
        t[9] = ( m[7] | m[6]);
        t[9] = ~t[9];
        t[10] = ( m[3] & m[2]);
        t[10] = ~t[10];
        t[11] = ( m[5] & m[4]);
        t[11] = ~t[11];
        t[12] = ( m[3] | m[2]);
        t[12] = ~t[12];

        t[13] = (t[1] ^ t[2] );
        t[14] = (t[3] ^ t[2] );
        t[15] = (t[4] ^ t[13] );
        t[16] = (t[5] ^ t[14] );
        t[17] = (t[9] ^ t[10] );
        t[18] = (t[11] ^ t[12] );
        t[19] = (t[6] ^ t[15] );
        t[20] = (t[7] ^ t[16] );
        p[3] = (t[19] ^ t[17] );
        p[2] = (t[20] ^ t[18] );
        p[1] = (t[8] ^ t[15] );
        p[0] = (t[6] ^ t[16] );
        
        // mid
        bit_t l[4];
        t[1] = ~(p[3] & p[0]);
        t[2] = ~(t[1] | p[2]);
        t[3] = ~(p[2] & p[0]);
        t[4] = (p[1] ^ t[3] );
        t[5] = ~(p[2] | t[4] );
        t[6] = ~(p[1] & t[4] );
        t[7] = ~(p[3] | t[4] );
        t[8] = ~(t[7] | t[2] );
        t[9] = ~(t[5] ^ t[7] );
        l[0] = ~(t[9] ^ p[3]);
        l[2] = ~(t[6] & t[8] );
        t[12] = ~(t[8] & p[1]);
        l[3] = ~(p[0] ^ t[12] );
        t[14] = ~(t[1] & p[2]);
        l[1] = ~(t[9] & t[14] );   

        // bottom
        bit_t e[18], k0, k1, k2, k3, k4;
        e[17]= (g[2] & l[2]);
        e[17] = ~e[17];
        e[16]= (g[3] & l[3]);
        e[16] = ~e[16];
        e[15]= (m[8] & k4 );
        e[15] = ~e[15];
        e[14]= (m[2] & k1 );
        e[14] = ~e[14];
        e[13]= (m[4] & k2 );
        e[13] = ~e[13];
        e[12]= (m[6] & k3 );
        e[12] = ~e[12];
        e[11]= (g[0] & l[0]);
        e[11] = ~e[11];
        e[10]= (g[1] & l[1]);
        e[10] = ~e[10];
        e[9]= (m[0] & k0 );
        e[9] = ~e[9];
        e[8]= (g[6] & l[2]);
        e[8] = ~e[8];
        e[7]= (g[7] & l[3]);
        e[7] = ~e[7];
        e[6]= (m[9] & k4 );
        e[6] = ~e[6];
        e[5]= (m[3] & k1 );
        e[5] = ~e[5];
        e[4]= (m[5] & k2 );
        e[4] = ~e[4];
        e[3]= (m[7] & k3 );
        e[3] = ~e[3];
        e[2]= (g[4] & l[0]);
        e[2] = ~e[2];
        e[1]= (g[5] & l[1]);
        e[1] = ~e[1];
        e[0]= (m[1] & k0 );
        e[0] = ~e[0];

        // output
        bit_t E[12];
        E[11] =(e[17] ^ e[16]);
        E[10] =(e[15] ^ e[16]);
        E[9] =(e[14] ^ e[13]);
        E[8] =(e[12] ^ e[13]);
        E[7] =(e[11] ^ e[10]);
        E[6] =(e[9] ^ e[10]);
        E[5] =(e[8] ^ e[7]);
        E[4] =(e[6] ^ e[7]);
        E[3] =(e[5] ^ e[4]);
        E[2] =(e[3] ^ e[4]);
        E[1] =(e[2] ^ e[1]);
        E[0] =(e[0] ^ e[1]);
        t[1] =(E[9] ^ E[7] );
        t[2] =(E[1] ^ t[1] );
        t[3] =(E[3] ^ t[2] );
        t[4] =(E[5] ^ E[3] );
        t[5] =(E[4] ^ t[4] );
        t[6] =(E[4] ^ E[0] );
        t[7] =(E[11] ^ E[7] );
        t[8] =(t[1] ^ t[4] );
        t[9] =(t[1] ^ t[6] );
        t[10] =(E[2] ^ t[5] );
        t[11] =(E[10] ^ E[8] );
        t[12] =~(t[3] ^ t[11] );
        t[13] =(t[10] ^ t[12] );
        t[14] =~(t[3] ^ t[7] );
        t[15] =~(E[10] ^ E[6] );
        t[16] =(t[6] ^ t[14] );
        *out7 = t[15];
        *out6 = t[13];
        *out5 = t[8];
        *out4 = t[14];
        *out3 = t[11];
        *out2 = t[9];
        *out1 = t[12];
        *out0 = t[16];
}


void Sm4_Scrutinizing_114gates(bits in, bit_t *out0, bit_t *out1, bit_t *out2, bit_t *out3, bit_t *out4, bit_t *out5, bit_t *out6, bit_t *out7){
        bit_t ti, g[8], m[10];

        // input 
        ti = (in.b7 ^ in.b5);
        g[4] = ~(in.b5 ^ in.b1);
        m[1] = ~(in.b0 ^ g[4] );
        m[4] = (in.b6 ^ in.b2);
        g[3] = (in.b3 ^ m[1] );
        m[0] = (in.b4 ^ ti );
        g[1] = (in.b1 ^ g[3] );
        m[2] = (in.b1 ^ m[4] );
        m[8] = (m[0] ^ m[2] );
        g[0] = (m[0] ^ g[1] );
        m[5] = ~(in.b3 ^ ti );
        m[9] = ~(in.b6 ^ m[8] );
        g[2] = (m[4] ^ g[0] );
        g[6] = (g[4] ^ m[5] );
        g[7] = (m[9] ^ g[6] );
        m[3] = (m[1] ^ m[9] );
        m[7] = (m[5] ^ m[3] ); 

        g[5] = ~in.b0;
        m[6] = in.b1;

        // top:
        bit_t p[4],t[21];
        t[1] = ( g[5] & g[1]);
        t[2] = ( m[1] & m[0]);
        t[3] = ( g[4] & g[0]);
        t[4] = ( g[7] & g[3]);
        t[5] = ( m[9] & m[8]);
        t[6] = ( g[6] | g[2]);
        t[7] = ( g[7] | g[3]);
        t[8] = ( m[9] | m[8]);
        t[9] = ( m[7] | m[6]);
        t[10] = ( m[3] & m[2]);
        t[11]= ( m[5] & m[4]);
        t[12] = ( m[3] | m[2]);

        t[13] = (t[1] ^ t[2] );
        t[14] = (t[3] ^ t[2] );
        t[15] = (t[4] ^ t[13] );
        t[16] = (t[5] ^ t[14] );
        t[17] = (t[9] ^ t[10] );
        t[18] = (t[11]^ t[12] );
        t[19] = (t[6] ^ t[15] );
        t[20] = (t[7] ^ t[16] );
        p[3] = (t[19] ^ t[17] );
        p[2] = (t[20] ^ t[18] );
        p[1] = (t[8] ^ t[15] );
        p[0] = (t[6] ^ t[16] );
        
        // mid
        bit_t l[4];
        t[0] = p[2] & p[1];
        t[1] = p[3] & p[0];
        t[2] = p[2] & p[0];
        t[3] = p[3] & p[1];
        t[4] = t[0] & t[2];
        t[5] = t[1] ^ t[3];
        t[6] = t[5] | p[0];
        t[7] = p[3] | t[2];
        l[3] = t[4] ^ t[6];
        t[9] = t[7] ^ t[3];
        l[0] = t[0] ^ t[9];
        t[11]= p[2] | t[5];
        t[12] = p[1] | t[2];
        l[2] = t[12] ^ t[5];
        l[1] = t[11]^ t[1];
        

        // bottom
        bit_t e[18], k0, k1, k2, k3, k4;
        k4 = (l[3] ^ l[2]);
        k3 = (l[3] ^ l[1]);
        k2 = (l[2] ^ l[0]);
        k1 = (k3 ^ k2 );
        k0 = (l[1] ^ l[0]);
        e[17]= (g[2] & l[2]);
        e[16]= (g[3] & l[3]);
        e[15]= (m[8] & k4 );
        e[14]= (m[2] & k1 );
        e[13]= (m[4] & k2 );
        e[12]= (m[6] & k3 );
        e[11]= (g[0] & l[0]);
        e[10]= (g[1] & l[1]);
        e[9]= (m[0] & k0 );
        e[8]= (g[6] & l[2]);
        e[7]= (g[7] & l[3]);
        e[6]= (m[9] & k4 );
        e[5]= (m[3] & k1 );
        e[4]= (m[5] & k2 );
        e[3]= (m[7] & k3 );
        e[2]= (g[4] & l[0]);
        e[1]= (g[5] & l[1]);
        e[0]= (m[1] & k0 );

        // output
        bit_t E[12];
        E[11] =(e[17] ^ e[16]);
        E[10] =(e[15] ^ e[16]);
        E[9] =(e[14] ^ e[13]);
        E[8] =(e[12] ^ e[13]);
        E[7] =(e[11] ^ e[10]);
        E[6] =(e[9] ^ e[10]);
        E[5] =(e[8] ^ e[7]);
        E[4] =(e[6] ^ e[7]);
        E[3] =(e[5] ^ e[4]);
        E[2] =(e[3] ^ e[4]);
        E[1] =(e[2] ^ e[1]);
        E[0] =(e[0] ^ e[1]);
        t[1] =(E[9] ^ E[7] );
        t[2] =(E[1] ^ t[1] );
        t[3] =(E[3] ^ t[2] );
        t[4] =(E[5] ^ E[3] );
        t[5] =(E[4] ^ t[4] );
        t[6] =(E[4] ^ E[0] );
        t[7] =(E[11] ^ E[7] );
        t[8] =(t[1] ^ t[4] );
        t[9] =(t[1] ^ t[6] );
        t[10] =(E[2] ^ t[5] );
        t[11]=(E[10] ^ E[8] );
        t[12] =~(t[3] ^ t[11]);
        t[13] =(t[10] ^ t[12] );
        t[14] =~(t[3] ^ t[7] );
        t[15] =~(E[10] ^ E[6] );
        t[16] =(t[6] ^ t[14] );
        *out7 = t[15];
        *out6 = t[13];
        *out5 = t[8];
        *out4 = t[14];
        *out3 = t[11];
        *out2 = t[9];
        *out1 = t[12];
        *out0 = t[16];
}

void AES_Depth16_BoolFun(bits in, bit_t *out0, bit_t *out1, bit_t *out2, bit_t *out3, bit_t *out4, bit_t *out5, bit_t *out6, bit_t *out7){

	bit_t T1 = in.b0 ^ in.b3;
	bit_t T2 = in.b0 ^ in.b5;
	bit_t T3 = in.b0 ^ in.b6;
	bit_t T4 = in.b3 ^ in.b5;
	bit_t T5 = in.b4 ^ in.b6;
	bit_t T6 = T1 ^ T5;
	bit_t T7 = in.b1 ^ in.b2;
	bit_t T8 = in.b7 ^ T6;
	bit_t T9 = in.b7 ^ T7;
	bit_t T10 = T6 ^ T7;
	bit_t T11 = in.b1 ^ in.b5;
	bit_t T12 = in.b2 ^ in.b5;
	bit_t T13 = T3 ^ T4;
	bit_t T14 = T6 ^ T11;
	bit_t T15 = T5 ^ T11;
	bit_t T16 = T5 ^ T12;
	bit_t T17 = T9 ^ T16;
	bit_t T18 = in.b3 ^ in.b7;
	bit_t T19 = T7 ^ T18;
	bit_t T20 = T1 ^ T19;
	bit_t T21 = in.b6 ^ in.b7;
	bit_t T22 = T7 ^ T21;
	bit_t T23 = T2 ^ T22;
	bit_t T24 = T2 ^ T10;
	bit_t T25 = T20 ^ T17;
	bit_t T26 = T3 ^ T16;
	bit_t T27 = T1 ^ T12;

    //The shared non-linear middle part for AES, AES^-1, and SM4
  	bit_t M1 = T13 & T6;
	bit_t M2 = T23 & T8;
	bit_t M3 = T14 ^ M1;
	bit_t M4 = T19 & in.b7;
	bit_t M5 = M4 ^ M1;
	bit_t M6 = T3 & T16;
	bit_t M7 = T22 & T9;
	bit_t M8 = T26 ^ M6;
	bit_t M9 = T20 & T17;
	bit_t M10 = M9 ^ M6;
	bit_t M11 = T1 & T15;
	bit_t M12 = T4 & T27;
	bit_t M13 = M12 ^ M11;
	bit_t M14 = T2 & T10;
	bit_t M15 = M14 ^ M11;
	bit_t M16 = M3 ^ M2;
	bit_t M17 = M5 ^ T24;
	bit_t M18 = M8 ^ M7;
	bit_t M19 = M10 ^ M15;
	bit_t M20 = M16 ^ M13;
	bit_t M21 = M17 ^ M15;
	bit_t M22 = M18 ^ M13;
	bit_t M23 = M19 ^ T25;
	bit_t M24 = M22 ^ M23;
	bit_t M25 = M22 & M20;
	bit_t M26 = M21 ^ M25;
	bit_t M27 = M20 ^ M21;
	bit_t M28 = M23 ^ M25;
	bit_t M29 = M28 & M27;
	bit_t M30 = M26 & M24;
	bit_t M31 = M20 & M23;
	bit_t M32 = M27 & M31;
	bit_t M33 = M27 ^ M25;
	bit_t M34 = M21 & M22;
	bit_t M35 = M24 & M34;
	bit_t M36 = M24 ^ M25;
	bit_t M37 = M21 ^ M29;
	bit_t M38 = M32 ^ M33;
	bit_t M39 = M23 ^ M30;
	bit_t M40 = M35 ^ M36;
	bit_t M41 = M38 ^ M40;
	bit_t M42 = M37 ^ M39;
	bit_t M43 = M37 ^ M38;
	bit_t M44 = M39 ^ M40;
	bit_t M45 = M42 ^ M41;
	bit_t M46 = M44 & T6;
	bit_t M47 = M40 & T8;
	bit_t M48 = M39 & in.b7;
	bit_t M49 = M43 & T16;
	bit_t M50 = M38 & T9;
	bit_t M51 = M37 & T17;
	bit_t M52 = M42 & T15;
	bit_t M53 = M45 & T27;
	bit_t M54 = M41 & T10;
	bit_t M55 = M44 & T13;
	bit_t M56 = M40 & T23;
	bit_t M57 = M39 & T19;
	bit_t M58 = M43 & T3;
	bit_t M59 = M38 & T22;
	bit_t M60 = M37 & T20;
	bit_t M61 = M42 & T1;
	bit_t M62 = M45 & T4;
	bit_t M63 = M41 & T2;

  //bottom(outer) linear layer for sm4
  	bit_t L0 = M61 ^ M62;
	bit_t L1 = M50 ^ M56;
	bit_t L2 = M46 ^ M48;
	bit_t L3 = M47 ^ M55;
	bit_t L4 = M54 ^ M58;
	bit_t L5 = M49 ^ M61;
	bit_t L6 = M62 ^ L5;
	bit_t L7 = M46 ^ L3;
	bit_t L8 = M51 ^ M59;
	bit_t L9 = M52 ^ M53;
	bit_t L10 = M53 ^ L4;
	bit_t L11 = M60 ^ L2;
	bit_t L12 = M48 ^ M51;
	bit_t L13 = M50 ^ L0;
	bit_t L14 = M52 ^ M61;
	bit_t L15 = M55 ^ L1;
	bit_t L16 = M56 ^ L0;
	bit_t L17 = M57 ^ L1;
	bit_t L18 = M58 ^ L8;
	bit_t L19 = M63 ^ L4;
	bit_t L20 = L0 ^ L1;
	bit_t L21 = L1 ^ L7;
	bit_t L22 = L3 ^ L12;
	bit_t L23 = L18 ^ L2;
	bit_t L24 = L15 ^ L9;
	bit_t L25 = L6 ^ L10;
	bit_t L26 = L7 ^ L9;
	bit_t L27 = L8 ^ L10;
	bit_t L28 = L11 ^ L14;
	bit_t L29 = L11 ^ L17;
	*out0 = L6 ^ L24;
	*out1 = L16 ^~ L26;
	*out2 = L19 ^~ L28;
	*out3 = L6 ^ L21;
	*out4 = L20 ^ L22;
	*out5 = L25 ^ L29;
	*out6 = L13 ^~ L27;
	*out7 = L6 ^~ L23;
}

//https://github.com/randombit/botan/pull/2353/commits/ce7f71c23c4089ddd875cc2032fae8bfdd88baf4
void AES_113gates(bits in, bit_t *out0, bit_t *out1, bit_t *out2, bit_t *out3, bit_t *out4, bit_t *out5, bit_t *out6, bit_t *out7)
{
   bit_t U0 = in.b0;
   bit_t U1 = in.b1;
   bit_t U2 = in.b2;
   bit_t U3 = in.b3;
   bit_t U4 = in.b4;
   bit_t U5 = in.b5;
   bit_t U6 = in.b6;
   bit_t U7 = in.b7;

   bit_t y14 = U3 ^ U5;
   bit_t y13 = U0 ^ U6;
   bit_t y9 = U0 ^ U3;
   bit_t y8 = U0 ^ U5;
   bit_t t0 = U1 ^ U2;
   bit_t y1 = t0 ^ U7;
   bit_t y4 = y1 ^ U3;
   bit_t y12 = y13 ^ y14;
   bit_t y2 = y1 ^ U0;
   bit_t y5 = y1 ^ U6;
   bit_t y3 = y5 ^ y8;
   bit_t t1 = U4 ^ y12;
   bit_t y15 = t1 ^ U5;
   bit_t y20 = t1 ^ U1;
   bit_t y6 = y15 ^ U7;
   bit_t y10 = y15 ^ t0;
   bit_t y11 = y20 ^ y9;
   bit_t y7 = U7 ^ y11;
   bit_t y17 = y10 ^ y11;
   bit_t y19 = y10 ^ y8;
   bit_t y16 = t0 ^ y11;
   bit_t y21 = y13 ^ y16;
   bit_t y18 = U0 ^ y16;
   bit_t t2 = y12 & y15;
   bit_t t3 = y3 & y6;
   bit_t t4 = t3 ^ t2;
   bit_t t5 = y4 & U7;
   bit_t t6 = t5 ^ t2;
   bit_t t7 = y13 & y16;
   bit_t t8 = y5 & y1;
   bit_t t9 = t8 ^ t7;
   bit_t t10 = y2 & y7;
   bit_t t11 = t10 ^ t7;
   bit_t t12 = y9 & y11;
   bit_t t13 = y14 & y17;
   bit_t t14 = t13 ^ t12;
   bit_t t15 = y8 & y10;
   bit_t t16 = t15 ^ t12;
   bit_t t17 = t4 ^ y20;
   bit_t t18 = t6 ^ t16;
   bit_t t19 = t9 ^ t14;
   bit_t t20 = t11 ^ t16;
   bit_t t21 = t17 ^ t14;
   bit_t t22 = t18 ^ y19;
   bit_t t23 = t19 ^ y21;
   bit_t t24 = t20 ^ y18;
   bit_t t25 = t21 ^ t22;
   bit_t t26 = t21 & t23;
   bit_t t27 = t24 ^ t26;
   bit_t t28 = t25 & t27;
   bit_t t29 = t28 ^ t22;
   bit_t t30 = t23 ^ t24;
   bit_t t31 = t22 ^ t26;
   bit_t t32 = t31 & t30;
   bit_t t33 = t32 ^ t24;
   bit_t t34 = t23 ^ t33;
   bit_t t35 = t27 ^ t33;
   bit_t t36 = t24 & t35;
   bit_t t37 = t36 ^ t34;
   bit_t t38 = t27 ^ t36;
   bit_t t39 = t29 & t38;
   bit_t t40 = t25 ^ t39;
   bit_t t41 = t40 ^ t37;
   bit_t t42 = t29 ^ t33;
   bit_t t43 = t29 ^ t40;
   bit_t t44 = t33 ^ t37;
   bit_t t45 = t42 ^ t41;
   bit_t z0 = t44 & y15;
   bit_t z1 = t37 & y6;
   bit_t z2 = t33 & U7;
   bit_t z3 = t43 & y16;
   bit_t z4 = t40 & y1;
   bit_t z5 = t29 & y7;
   bit_t z6 = t42 & y11;
   bit_t z7 = t45 & y17;
   bit_t z8 = t41 & y10;
   bit_t z9 = t44 & y12;
   bit_t z10 = t37 & y3;
   bit_t z11 = t33 & y4;
   bit_t z12 = t43 & y13;
   bit_t z13 = t40 & y5;
   bit_t z14 = t29 & y2;
   bit_t z15 = t42 & y9;
   bit_t z16 = t45 & y14;
   bit_t z17 = t41 & y8;
   bit_t tc1 = z15 ^ z16;
   bit_t tc2 = z10 ^ tc1;
   bit_t tc3 = z9 ^ tc2;
   bit_t tc4 = z0 ^ z2;
   bit_t tc5 = z1 ^ z0;
   bit_t tc6 = z3 ^ z4;
   bit_t tc7 = z12 ^ tc4;
   bit_t tc8 = z7 ^ tc6;
   bit_t tc9 = z8 ^ tc7;
   bit_t tc10 = tc8 ^ tc9;
   bit_t tc11 = tc6 ^ tc5;
   bit_t tc12 = z3 ^ z5;
   bit_t tc13 = z13 ^ tc1;
   bit_t tc14 = tc4 ^ tc12;
    *out3 = tc3 ^ tc11;
   bit_t tc16 = z6 ^ tc8;
   bit_t tc17 = z14 ^ tc10;
   bit_t tc18 = tc13 ^ tc14;
   *out7 = ~(z12 ^ tc18);
   bit_t tc20 = z15 ^ tc16;
   bit_t tc21 = tc2 ^ z11;
   *out0 = tc3 ^ tc16;
   *out6 = ~(tc10 ^ tc18);
   *out4 = tc14 ^ *out3;
   *out1 = ~(*out3 ^ tc16);
   bit_t tc26 = tc17 ^ tc20;
   *out2 = ~(tc26 ^ z17);
   *out5 = tc21 ^ tc17;
}



void Sm4_Sel_BoolFun(bits in, bit_t *out0, bit_t *out1, bit_t *out2, bit_t *out3, bit_t *out4, bit_t *out5, bit_t *out6, bit_t *out7) {
  bit_t var8 = ~in.b7;
  bit_t var9 = var8 | in.b6;
  bit_t var10 = var9 & in.b5;
  bit_t var11 = in.b2 ^ var10;
  bit_t var12 = var11 | in.b0;
  bit_t var13 = in.b6 ^ var12;
  bit_t var14 = in.b7 & var11;
  bit_t var15 = var14 | in.b0;
  bit_t var16 = var10 ^ var15;
  bit_t var17 = var16 & in.b4;
  bit_t var18 = var13 ^ var17;
  bit_t var19 = var18 ^ var8;
  bit_t var20 = var19 | in.b5;
  bit_t var21 = in.b7 ^ var20;
  bit_t var22 = var18 | in.b7;
  bit_t var23 = var22 ^ var15;
  bit_t var24 = var23 | in.b4;
  bit_t var25 = var21 ^ var24;
  bit_t var26 = var25 | in.b2;
  bit_t var27 = var18 ^ var26;
  bit_t var28 = in.b7 ^ in.b2;
  bit_t var29 = var28 & in.b4;
  bit_t var30 = var27 ^ var29;
  bit_t var31 = var18 | var28;
  bit_t var32 = var31 ^ var25;
  bit_t var33 = var32 & in.b5;
  bit_t var34 = var30 ^ var33;
  bit_t var35 = var8 & var32;
  bit_t var36 = in.b6 ^ var9;
  bit_t var37 = var36 | in.b2;
  bit_t var38 = var35 ^ var37;
  bit_t var39 = var38 | in.b0;
  bit_t var40 = var34 ^ var39;
  bit_t var41 = var40 & in.b1;
  bit_t var42 = var27 ^ var41;
  bit_t var43 = var10 & in.b6;
  bit_t var44 = var43 ^ var40;
  bit_t var45 = var26 & var19;
  bit_t var46 = var45 | in.b4;
  bit_t var47 = var44 ^ var46;
  bit_t var48 = in.b0 ^ var24;
  bit_t var49 = var48 ^ var44;
  bit_t var50 = var48 & var47;
  bit_t var51 = var50 & in.b7;
  bit_t var52 = var49 ^ var51;
  bit_t var53 = var52 & in.b1;
  bit_t var54 = var47 ^ var53;
  bit_t var55 = var42 & var9;
  bit_t var56 = var55 ^ var39;
  bit_t var57 = var53 ^ var43;
  bit_t var58 = var57 & in.b4;
  bit_t var59 = var56 ^ var58;
  bit_t var60 = var59 & var25;
  bit_t var61 = var60 ^ var13;
  bit_t var62 = var8 | var59;
  bit_t var63 = var62 ^ var30;
  bit_t var64 = var63 & in.b1;
  bit_t var65 = var61 ^ var64;
  bit_t var66 = var65 & in.b0;
  bit_t var67 = var59 ^ var66;
  bit_t var68 = var67 & in.b2;
  bit_t var69 = var54 ^ var68;
  bit_t var70 = var69 & in.b3;
  *out4 = var42 ^ var70;
  bit_t var72 = in.b4 ^ var27;
  bit_t var73 = in.b0 ^ var30;
  bit_t var74 = var73 & in.b6;
  bit_t var75 = var72 ^ var74;
  bit_t var76 = var49 & *out4;
  bit_t var77 = in.b7 ^ var69;
  bit_t var78 = var77 ^ var36;
  bit_t var79 = var78 | in.b4;
  bit_t var80 = var76 ^ var79;
  bit_t var81 = var80 | in.b5;
  bit_t var82 = var75 ^ var81;
  bit_t var83 = var69 & var53;
  bit_t var84 = var83 ^ var13;
  bit_t var85 = var75 & in.b2;
  bit_t var86 = var84 ^ var85;
  bit_t var87 = in.b6 ^ var8;
  bit_t var88 = var39 ^ var53;
  bit_t var89 = var88 | var65;
  bit_t var90 = var89 & in.b5;
  bit_t var91 = var87 ^ var90;
  bit_t var92 = var91 & in.b4;
  bit_t var93 = var86 ^ var92;
  bit_t var94 = var93 | in.b3;
  bit_t var95 = var82 ^ var94;
  bit_t var96 = var75 & var63;
  bit_t var97 = var96 | var92;
  bit_t var98 = var97 | in.b2;
  bit_t var99 = var69 ^ var98;
  bit_t var100 = var12 & var19;
  bit_t var101 = var100 ^ var84;
  bit_t var102 = var101 | in.b2;
  bit_t var103 = var66 ^ var102;
  bit_t var104 = var103 & in.b3;
  bit_t var105 = var99 ^ var104;
  bit_t var106 = var67 & var104;
  bit_t var107 = var106 ^ var19;
  bit_t var108 = var107 | in.b6;
  bit_t var109 = var35 ^ var108;
  bit_t var110 = var31 & *out4;
  bit_t var111 = var110 ^ in.b3;
  bit_t var112 = var42 ^ var101;
  bit_t var113 = var112 & in.b6;
  bit_t var114 = var111 ^ var113;
  bit_t var115 = var114 & in.b4;
  bit_t var116 = var109 ^ var115;
  bit_t var117 = var116 & in.b5;
  bit_t var118 = var105 ^ var117;
  bit_t var119 = var118 | in.b1;
  *out6 = var95 ^ var119;
  bit_t var121 = var117 ^ var63;
  bit_t var122 = var121 & var108;
  bit_t var123 = var49 | in.b4;
  bit_t var124 = var122 ^ var123;
  bit_t var125 = var93 ^ var98;
  bit_t var126 = var97 ^ var34;
  bit_t var127 = var126 | var60;
  bit_t var128 = var127 | in.b4;
  bit_t var129 = var125 ^ var128;
  bit_t var130 = var129 & in.b3;
  bit_t var131 = var124 ^ var130;
  bit_t var132 = var81 ^ var78;
  bit_t var133 = var36 ^ var35;
  bit_t var134 = var133 | in.b4;
  bit_t var135 = var132 ^ var134;
  bit_t var136 = var119 | *out6;
  bit_t var137 = var60 | var132;
  bit_t var138 = var137 | in.b7;
  bit_t var139 = var136 ^ var138;
  bit_t var140 = var139 | in.b3;
  bit_t var141 = var135 ^ var140;
  bit_t var142 = var141 & in.b2;
  bit_t var143 = var131 ^ var142;
  bit_t var144 = var49 & var121;
  bit_t var145 = ~var144;
  bit_t var146 = var106 | var113;
  bit_t var147 = var146 | in.b2;
  bit_t var148 = var145 ^ var147;
  bit_t var149 = var40 ^ var113;
  bit_t var150 = var149 | in.b3;
  bit_t var151 = var148 ^ var150;
  bit_t var152 = var109 & var105;
  bit_t var153 = var152 ^ var97;
  bit_t var154 = var153 & in.b0;
  bit_t var155 = var95 ^ var154;
  bit_t var156 = var118 | var135;
  bit_t var157 = var156 ^ var128;
  bit_t var158 = var157 | in.b3;
  bit_t var159 = var147 ^ var158;
  bit_t var160 = var159 & in.b5;
  bit_t var161 = var155 ^ var160;
  bit_t var162 = var161 | in.b7;
  bit_t var163 = var151 ^ var162;
  bit_t var164 = var163 & in.b1;
  *out7 = var143 ^ var164;
  bit_t var166 = var115 & var82;
  bit_t var167 = var166 ^ var77;
  bit_t var168 = var156 ^ var60;
  bit_t var169 = var168 | in.b2;
  bit_t var170 = var167 ^ var169;
  bit_t var171 = var152 & var115;
  bit_t var172 = var171 ^ var65;
  bit_t var173 = var172 & in.b1;
  bit_t var174 = var170 ^ var173;
  bit_t var175 = var87 ^ in.b4;
  bit_t var176 = var175 ^ var139;
  bit_t var177 = var61 & in.b1;
  bit_t var178 = var176 ^ var177;
  bit_t var179 = var49 & var37;
  bit_t var180 = var179 ^ *out7;
  bit_t var181 = var180 | in.b7;
  bit_t var182 = var178 ^ var181;
  bit_t var183 = var182 | in.b3;
  bit_t var184 = var174 ^ var183;
  bit_t var185 = var137 & var83;
  bit_t var186 = ~var162;
  bit_t var187 = var186 | var95;
  bit_t var188 = var187 | in.b1;
  bit_t var189 = var185 ^ var188;
  bit_t var190 = var166 | var10;
  bit_t var191 = var160 | var100;
  bit_t var192 = var191 | in.b1;
  bit_t var193 = var190 ^ var192;
  bit_t var194 = var193 & in.b3;
  bit_t var195 = var189 ^ var194;
  bit_t var196 = var192 ^ var149;
  bit_t var197 = var196 & var138;
  bit_t var198 = ~var43;
  bit_t var199 = var128 ^ var140;
  bit_t var200 = var199 & in.b2;
  bit_t var201 = var198 ^ var200;
  bit_t var202 = var201 & in.b1;
  bit_t var203 = var197 ^ var202;
  bit_t var204 = var203 | in.b4;
  bit_t var205 = var195 ^ var204;
  bit_t var206 = var205 & in.b0;
  *out2 = var184 ^ var206;
  bit_t var208 = var200 ^ var29;
  bit_t var209 = var61 | var30;
  bit_t var210 = var209 | in.b5;
  bit_t var211 = var208 ^ var210;
  bit_t var212 = var168 & var132;
  bit_t var213 = var212 ^ var205;
  bit_t var214 = var213 | in.b1;
  bit_t var215 = var211 ^ var214;
  bit_t var216 = var136 ^ var32;
  bit_t var217 = var164 | var196;
  bit_t var218 = var217 & in.b0;
  bit_t var219 = var216 ^ var218;
  bit_t var220 = var96 & var214;
  bit_t var221 = var220 | var54;
  bit_t var222 = var158 ^ var176;
  bit_t var223 = var222 & in.b0;
  bit_t var224 = var221 ^ var223;
  bit_t var225 = var224 & in.b4;
  bit_t var226 = var219 ^ var225;
  bit_t var227 = var226 | in.b6;
  bit_t var228 = var215 ^ var227;
  bit_t var229 = var146 | var172;
  bit_t var230 = var229 & var215;
  bit_t var231 = var164 | var80;
  bit_t var232 = var231 ^ var228;
  bit_t var233 = var93 & in.b4;
  bit_t var234 = var232 ^ var233;
  bit_t var235 = var234 & in.b5;
  bit_t var236 = var230 ^ var235;
  bit_t var237 = var234 | var124;
  bit_t var238 = var237 ^ var131;
  bit_t var239 = var223 ^ var127;
  bit_t var240 = var191 ^ var197;
  bit_t var241 = var240 & in.b1;
  bit_t var242 = var239 ^ var241;
  bit_t var243 = var242 & in.b4;
  bit_t var244 = var238 ^ var243;
  bit_t var245 = var244 & in.b6;
  bit_t var246 = var236 ^ var245;
  bit_t var247 = var246 & in.b3;
  *out1 = var228 ^ var247;
  bit_t var249 = var200 ^ var47;
  bit_t var250 = var184 ^ var75;
  bit_t var251 = var250 | in.b5;
  bit_t var252 = var249 ^ var251;
  bit_t var253 = var92 | var53;
  bit_t var254 = var56 ^ var153;
  bit_t var255 = var254 | in.b3;
  bit_t var256 = var253 ^ var255;
  bit_t var257 = var256 | in.b0;
  bit_t var258 = var252 ^ var257;
  bit_t var259 = var142 ^ var158;
  bit_t var260 = var259 | var97;
  bit_t var261 = var73 ^ var253;
  bit_t var262 = var169 ^ var21;
  bit_t var263 = var262 & in.b3;
  bit_t var264 = var261 ^ var263;
  bit_t var265 = var264 | in.b0;
  bit_t var266 = var260 ^ var265;
  bit_t var267 = var266 | in.b7;
  bit_t var268 = var258 ^ var267;
  bit_t var269 = var245 ^ var167;
  bit_t var270 = var269 & in.b4;
  bit_t var271 = in.b2 ^ var270;
  bit_t var272 = var249 & var145;
  bit_t var273 = var84 ^ var235;
  bit_t var274 = var273 | in.b2;
  bit_t var275 = var272 ^ var274;
  bit_t var276 = var275 | in.b6;
  bit_t var277 = var271 ^ var276;
  bit_t var278 = var193 | var67;
  bit_t var279 = var278 & var94;
  bit_t var280 = *out4 | var278;
  bit_t var281 = var280 ^ var237;
  bit_t var282 = var70 | var48;
  bit_t var283 = var282 | in.b2;
  bit_t var284 = var281 ^ var283;
  bit_t var285 = var284 & in.b6;
  bit_t var286 = var279 ^ var285;
  bit_t var287 = var286 & in.b0;
  bit_t var288 = var277 ^ var287;
  bit_t var289 = var288 | in.b1;
  *out3 = var268 ^ var289;
  bit_t var291 = in.b7 & var216;
  bit_t var292 = var80 ^ var259;
  bit_t var293 = var292 | in.b4;
  bit_t var294 = var291 ^ var293;
  bit_t var295 = var231 ^ var140;
  bit_t var296 = var295 | var113;
  bit_t var297 = var296 & in.b5;
  bit_t var298 = var294 ^ var297;
  bit_t var299 = var31 ^ var79;
  bit_t var300 = var78 ^ var126;
  bit_t var301 = var300 | in.b2;
  bit_t var302 = var299 ^ var301;
  bit_t var303 = var50 ^ var271;
  bit_t var304 = var303 | in.b7;
  bit_t var305 = var216 ^ var304;
  bit_t var306 = var305 & in.b0;
  bit_t var307 = var302 ^ var306;
  bit_t var308 = var307 & in.b1;
  bit_t var309 = var298 ^ var308;
  bit_t var310 = var168 ^ var102;
  bit_t var311 = var181 ^ var276;
  bit_t var312 = var311 | in.b7;
  bit_t var313 = var310 ^ var312;
  bit_t var314 = var305 | var243;
  bit_t var315 = var314 ^ var134;
  bit_t var316 = var315 & in.b5;
  bit_t var317 = var313 ^ var316;
  bit_t var318 = var32 ^ var154;
  bit_t var319 = var318 ^ var186;
  bit_t var320 = var289 ^ var194;
  bit_t var321 = var125 & in.b0;
  bit_t var322 = var320 ^ var321;
  bit_t var323 = var322 | in.b2;
  bit_t var324 = var319 ^ var323;
  bit_t var325 = var324 | in.b1;
  bit_t var326 = var317 ^ var325;
  bit_t var327 = var326 & in.b3;
  *out5 = var309 ^ var327;
  bit_t var329 = var122 ^ var115;
  bit_t var330 = var140 | var299;
  bit_t var331 = var330 & in.b7;
  bit_t var332 = var329 ^ var331;
  bit_t var333 = var115 ^ var250;
  bit_t var334 = var236 & in.b0;
  bit_t var335 = var333 ^ var334;
  bit_t var336 = var335 & in.b3;
  bit_t var337 = var332 ^ var336;
  bit_t var338 = var266 ^ var164;
  bit_t var339 = var70 ^ var239;
  bit_t var340 = var339 | in.b5;
  bit_t var341 = var338 ^ var340;
  bit_t var342 = var88 ^ var242;
  bit_t var343 = var342 | var98;
  bit_t var344 = var343 | in.b7;
  bit_t var345 = var341 ^ var344;
  bit_t var346 = var345 & in.b1;
  bit_t var347 = var337 ^ var346;
  bit_t var348 = var295 ^ var74;
  bit_t var349 = var348 ^ var268;
  bit_t var350 = var59 ^ var157;
  bit_t var351 = var347 ^ var262;
  bit_t var352 = var351 | in.b7;
  bit_t var353 = var350 ^ var352;
  bit_t var354 = var353 & in.b1;
  bit_t var355 = var349 ^ var354;
  bit_t var356 = var115 ^ var15;
  bit_t var357 = var356 | var126;
  bit_t var358 = var193 ^ var286;
  bit_t var359 = var25 ^ var260;
  bit_t var360 = var359 & in.b0;
  bit_t var361 = var358 ^ var360;
  bit_t var362 = var361 | in.b1;
  bit_t var363 = var357 ^ var362;
  bit_t var364 = var363 & in.b3;
  bit_t var365 = var355 ^ var364;
  bit_t var366 = var365 & in.b2;
  *out0 = var347 ^ var366;
}